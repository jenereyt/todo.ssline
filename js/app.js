export let tasks = [
    {
        id: 1,
        dateSet: "2025-03-25",
        project: "Afrosiyob paranda",
        theme: "–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ UI",
        description: "–°–æ–∑–¥–∞—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã",
        status: "–í—ã–ø–æ–ª–Ω–µ–Ω–æ",
        executors: ["–†—É—Å—Ç–∞–º–æ–≤ –ñ–æ–Ω–∏–±–µ–∫", "–•—Ä–∞–º–æ–≤ –î–æ–Ω–∏—à"],
        files: [{ name: "project_alpha_ui_mockup.pdf", url: "https://example.com/files/project_alpha_ui_mockup.pdf" }],
        comments: [
            { text: "–î–∏–∑–∞–π–Ω —É—Ç–≤–µ—Ä–∂–¥—ë–Ω –∑–∞–∫–∞–∑—á–∏–∫–æ–º", date: "2025-03-25" },
            { text: "–î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ —à—Ä–∏—Ñ—Ç—ã", date: "2025-03-26" },
            { text: "–ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –æ—Ç—Å—Ç—É–ø—ã –Ω–∞ –º–æ–±–∏–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–∏", date: "2025-03-26" }
        ],
        deadline: "2025-04-05"
    },
    {
        id: 2,
        dateSet: "2025-03-24",
        project: "–ó–∞–∫–∞–∑—á–∏–∫ Beta",
        theme: "–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–≥–æ–≤",
        description: "–ü–æ—Ñ–∏–∫—Å–∏—Ç—å –æ—à–∏–±–∫—É –≤ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏",
        status: "–ü—Ä–∏–Ω—è—Ç–æ –∑–∞–∫–∞–∑—á–∏–∫–æ–º",
        executors: ["–°–∞–π–¥—É–ª–ª–∞–µ–≤ –î–∞–º–∏—Ä"],
        files: [
            { name: "bug_fix_report.pdf", url: "https://example.com/files/bug_fix_report.pdf" },
            { name: "auth_test.pdf", url: "https://example.com/files/auth_test.pdf" }
        ],
        deadline: "2025-04-01"
    },
    {
        id: 3,
        dateSet: "2025-03-20",
        project: "–ü—Ä–æ–µ–∫—Ç Gamma",
        theme: "–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API",
        description: "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã",
        status: "–í –ø—Ä–æ—Ü–µ—Å—Å–µ",
        executors: ["–Æ–≥–∞–π –î–º–∏—Ç—Ä–∏–π"],
        files: [],
        comments: [],
        deadline: "2025-04-10"
    },
    {
        id: 4,
        dateSet: "2025-03-22",
        project: "–ó–∞–∫–∞–∑—á–∏–∫ Delta",
        theme: "–î–∏–∑–∞–π–Ω –ª–æ–≥–æ—Ç–∏–ø–∞",
        description: "–†–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å –Ω–æ–≤—ã–π –ª–æ–≥–æ—Ç–∏–ø –∫–æ–º–ø–∞–Ω–∏–∏",
        status: "–ê–Ω–Ω—É–ª–∏—Ä–æ–≤–∞–Ω–æ",
        executors: ["–ó–∞–∫–∏—Ä–æ–≤ –§–∞—Ä—Ä—É—Ö", "–ë—É—Ä—Ö–∞–Ω–æ–≤ –ê–∑–∏–º"],
        files: [],
        deadline: "2025-03-30"
    },
    {
        id: 5,
        dateSet: "2025-03-23",
        project: "–ü—Ä–æ–µ–∫—Ç Epsilon",
        theme: "–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∫–æ–¥–∞",
        description: "–£—Å–∫–æ—Ä–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã",
        status: "–í–æ–∑–≤—Ä–∞—â–µ–Ω",
        executors: ["–ù—É—Ä–º–∞–Ω–æ–≤ –ê–Ω–≤–∞—Ä", "–ù–∞—Ä–∑—É–ª–ª–æ–µ–≤ –¢–æ—Ö–∏—Ä"],
        files: [],
        comments: [],
        deadline: "2025-04-07"
    },
    {
        id: 6,
        dateSet: "2025-03-26",
        project: "–ü—Ä–æ–µ–∫—Ç Zeta",
        theme: "–ê–Ω–∞–ª–∏—Ç–∏–∫–∞",
        description: "–°–æ–±—Ä–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º",
        status: "–ü—Ä–∏–Ω—è—Ç–æ",
        executors: ["–†—É—Å—Ç–∞–º–æ–≤ –ñ–æ–Ω–∏–±–µ–∫"],
        files: [],
        comments: [],
        deadline: "2025-04-12"
    },
    {
        id: 7,
        dateSet: "2025-03-27",
        project: "–ó–∞–∫–∞–∑—á–∏–∫ Eta",
        theme: "–î–∏–∑–∞–π–Ω",
        description: "–û–±–Ω–æ–≤–∏—Ç—å –±–∞–Ω–Ω–µ—Ä—ã –Ω–∞ —Å–∞–π—Ç–µ",
        status: "–í—ã–ø–æ–ª–Ω–µ–Ω–æ",
        executors: ["–•—Ä–∞–º–æ–≤ –î–æ–Ω–∏—à"],
        files: [],
        comments: [],
        deadline: "2025-04-03"
    },
    {
        id: 8,
        dateSet: "2025-03-28",
        project: "–ü—Ä–æ–µ–∫—Ç Theta",
        theme: "–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞",
        description: "–î–æ–±–∞–≤–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä –≤ —Ç–∞–±–ª–∏—Ü—É",
        status: "–í –ø—Ä–æ—Ü–µ—Å—Å–µ",
        executors: ["–°–∞–π–¥—É–ª–ª–∞–µ–≤ –î–∞–º–∏—Ä"],
        files: [],
        comments: [],
        deadline: "2025-04-15"
    },
    {
        id: 9,
        dateSet: "2025-03-29",
        project: "–ó–∞–∫–∞–∑—á–∏–∫ Iota",
        theme: "–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ",
        description: "–ü—Ä–æ–≤–µ—Å—Ç–∏ –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ",
        status: "–í–æ–∑–≤—Ä–∞—â–µ–Ω",
        executors: ["–Æ–≥–∞–π –î–º–∏—Ç—Ä–∏–π"],
        files: [],
        comments: [],
        deadline: "2025-04-10"
    },
    {
        id: 10,
        dateSet: "2025-03-30",
        project: "–ü—Ä–æ–µ–∫—Ç Kappa",
        theme: "–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è",
        description: "–£–º–µ–Ω—å—à–∏—Ç—å –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ —Å–µ—Ä–≤–µ—Ä–∞",
        status: "–ü—Ä–∏–Ω—è—Ç–æ –∑–∞–∫–∞–∑—á–∏–∫–æ–º",
        executors: ["–ó–∞–∫–∏—Ä–æ–≤ –§–∞—Ä—Ä—É—Ö"],
        files: [],
        comments: [],
        deadline: "2025-04-08"
    },
    {
        id: 11,
        dateSet: "2025-04-01",
        project: "–ü—Ä–æ–µ–∫—Ç Lambda",
        theme: "–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è",
        description: "–ü–æ–¥–∫–ª—é—á–∏—Ç—å API –ø–ª–∞—Ç–µ–∂–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã",
        status: "–í –ø—Ä–æ—Ü–µ—Å—Å–µ",
        executors: ["–ë—É—Ä—Ö–∞–Ω–æ–≤ –ê–∑–∏–º"],
        files: [],
        comments: [],
        deadline: "2025-04-20"
    },
    {
        id: 12,
        dateSet: "2025-04-02",
        project: "–ó–∞–∫–∞–∑—á–∏–∫ Mu",
        theme: "–î–∏–∑–∞–π–Ω",
        description: "–°–æ–∑–¥–∞—Ç—å –º–∞–∫–µ—Ç –º–æ–±–∏–ª—å–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è",
        status: "–í—ã–ø–æ–ª–Ω–µ–Ω–æ",
        executors: ["–ù—É—Ä–º–∞–Ω–æ–≤ –ê–Ω–≤–∞—Ä"],
        files: [],
        comments: [],
        deadline: "2025-04-10"
    },
    {
        id: 13,
        dateSet: "2025-04-03",
        project: "–ü—Ä–æ–µ–∫—Ç Nu",
        theme: "–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞",
        description: "–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é —á–µ—Ä–µ–∑ OAuth",
        status: "–ü—Ä–∏–Ω—è—Ç–æ",
        executors: ["–ù–∞—Ä–∑—É–ª–ª–æ–µ–≤ –¢–æ—Ö–∏—Ä"],
        files: [],
        comments: [],
        deadline: "2025-04-18"
    },
    {
        id: 14,
        dateSet: "2025-04-04",
        project: "–ó–∞–∫–∞–∑—á–∏–∫ Xi",
        theme: "–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ",
        description: "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å iOS",
        status: "–ê–Ω–Ω—É–ª–∏—Ä–æ–≤–∞–Ω–æ",
        executors: ["–†—É—Å—Ç–∞–º–æ–≤ –ñ–æ–Ω–∏–±–µ–∫"],
        files: [],
        comments: [],
        deadline: "2025-04-12"
    },
    {
        id: 15,
        dateSet: "2025-04-05",
        project: "–ü—Ä–æ–µ–∫—Ç Omicron",
        theme: "–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è",
        description: "–°–∂–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∞ —Å–∞–π—Ç–µ",
        status: "–ü—Ä–∏–Ω—è—Ç–æ –∑–∞–∫–∞–∑—á–∏–∫–æ–º",
        executors: ["–•—Ä–∞–º–æ–≤ –î–æ–Ω–∏—à"],
        files: [],
        comments: [],
        deadline: "2025-04-15"
    },
    {
        id: 16,
        dateSet: "2025-04-06",
        project: "–ó–∞–∫–∞–∑—á–∏–∫ Pi",
        theme: "–ê–Ω–∞–ª–∏—Ç–∏–∫–∞",
        description: "–ù–∞—Å—Ç—Ä–æ–∏—Ç—å Google Analytics",
        status: "–í –ø—Ä–æ—Ü–µ—Å—Å–µ",
        executors: ["–°–∞–π–¥—É–ª–ª–∞–µ–≤ –î–∞–º–∏—Ä"],
        files: [],
        comments: [],
        deadline: "2025-04-20"
    },
    {
        id: 17,
        dateSet: "2025-04-07",
        project: "–ü—Ä–æ–µ–∫—Ç Rho",
        theme: "–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞",
        description: "–î–æ–±–∞–≤–∏—Ç—å —Ñ–æ—Ä–º—É –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏",
        status: "–í—ã–ø–æ–ª–Ω–µ–Ω–æ",
        executors: ["–Æ–≥–∞–π –î–º–∏—Ç—Ä–∏–π"],
        files: [],
        comments: [],
        deadline: "2025-04-14"
    },
    {
        id: 18,
        dateSet: "2025-04-08",
        project: "–ó–∞–∫–∞–∑—á–∏–∫ Sigma",
        theme: "–î–∏–∑–∞–π–Ω",
        description: "–û–±–Ω–æ–≤–∏—Ç—å —Ü–≤–µ—Ç–æ–≤—É—é —Å—Ö–µ–º—É",
        status: "–í–æ–∑–≤—Ä–∞—â–µ–Ω",
        executors: ["–ó–∞–∫–∏—Ä–æ–≤ –§–∞—Ä—Ä—É—Ö"],
        files: [],
        comments: [],
        deadline: "2025-04-18"
    },
    {
        id: 19,
        dateSet: "2025-04-09",
        project: "–ü—Ä–æ–µ–∫—Ç Tau",
        theme: "–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ",
        description: "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫—Ä–æ—Å—Å–±—Ä–∞—É–∑–µ—Ä–Ω–æ—Å—Ç—å",
        status: "–í –ø—Ä–æ—Ü–µ—Å—Å–µ",
        executors: ["–ë—É—Ä—Ö–∞–Ω–æ–≤ –ê–∑–∏–º"],
        files: [],
        comments: [],
        deadline: "2025-04-25"
    },
    {
        id: 20,
        dateSet: "2025-04-10",
        project: "–ó–∞–∫–∞–∑—á–∏–∫ Upsilon",
        theme: "–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è",
        description: "–ü–æ–¥–∫–ª—é—á–∏—Ç—å CRM —Å–∏—Å—Ç–µ–º—É",
        status: "–ü—Ä–∏–Ω—è—Ç–æ",
        executors: ["–ù—É—Ä–º–∞–Ω–æ–≤ –ê–Ω–≤–∞—Ä"],
        files: [],
        comments: [],
        deadline: "2025-04-22"
    },
    {
        id: 21,
        dateSet: "2025-04-11",
        project: "–ü—Ä–æ–µ–∫—Ç Phi",
        theme: "–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞",
        description: "–°–æ–∑–¥–∞—Ç—å –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å",
        status: "–í—ã–ø–æ–ª–Ω–µ–Ω–æ",
        executors: ["–ù–∞—Ä–∑—É–ª–ª–æ–µ–≤ –¢–æ—Ö–∏—Ä"],
        files: [],
        comments: [],
        deadline: "2025-04-20"
    },
    {
        id: 22,
        dateSet: "2025-04-12",
        project: "–ó–∞–∫–∞–∑—á–∏–∫ Chi",
        theme: "–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è",
        description: "–£—Å–∫–æ—Ä–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É –≤–∏–¥–µ–æ",
        status: "–í –ø—Ä–æ—Ü–µ—Å—Å–µ",
        executors: ["–†—É—Å—Ç–∞–º–æ–≤ –ñ–æ–Ω–∏–±–µ–∫"],
        files: [],
        comments: [],
        deadline: "2025-04-30"
    },
    {
        id: 23,
        dateSet: "2025-04-13",
        project: "–ü—Ä–æ–µ–∫—Ç Psi",
        theme: "–î–∏–∑–∞–π–Ω",
        description: "–†–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å –∏–∫–æ–Ω–∫–∏ –¥–ª—è –º–µ–Ω—é",
        status: "–ü—Ä–∏–Ω—è—Ç–æ –∑–∞–∫–∞–∑—á–∏–∫–æ–º",
        executors: ["–•—Ä–∞–º–æ–≤ –î–æ–Ω–∏—à"],
        files: [],
        comments: [],
        deadline: "2025-04-20"
    },
    {
        id: 24,
        dateSet: "2025-04-14",
        project: "–ó–∞–∫–∞–∑—á–∏–∫ Omega",
        theme: "–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ",
        description: "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É —á–∞—Ç–∞",
        status: "–ê–Ω–Ω—É–ª–∏—Ä–æ–≤–∞–Ω–æ",
        executors: ["–°–∞–π–¥—É–ª–ª–∞–µ–≤ –î–∞–º–∏—Ä"],
        files: [],
        comments: [],
        deadline: "2025-04-25"
    },
    {
        id: 25,
        dateSet: "2025-04-15",
        project: "–ü—Ä–æ–µ–∫—Ç Alpha-2",
        theme: "–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞",
        description: "–î–æ–±–∞–≤–∏—Ç—å –ø–æ–∏—Å–∫ –ø–æ —Å–∞–π—Ç—É",
        status: "–í—ã–ø–æ–ª–Ω–µ–Ω–æ",
        executors: ["–Æ–≥–∞–π –î–º–∏—Ç—Ä–∏–π"],
        files: [],
        comments: [],
        deadline: "2025-04-22"
    },
    {
        id: 26,
        dateSet: "2025-04-16",
        project: "–ó–∞–∫–∞–∑—á–∏–∫ Beta-2",
        theme: "–ê–Ω–∞–ª–∏—Ç–∏–∫–∞",
        description: "–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω–≤–µ—Ä—Å–∏–∏",
        status: "–í –ø—Ä–æ—Ü–µ—Å—Å–µ",
        executors: ["–ó–∞–∫–∏—Ä–æ–≤ –§–∞—Ä—Ä—É—Ö"],
        files: [],
        comments: [],
        deadline: "2025-05-01"
    },
    {
        id: 27,
        dateSet: "2025-04-17",
        project: "–ü—Ä–æ–µ–∫—Ç Gamma-2",
        theme: "–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è",
        description: "–ü–æ–¥–∫–ª—é—á–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è",
        status: "–ü—Ä–∏–Ω—è—Ç–æ",
        executors: ["–ë—É—Ä—Ö–∞–Ω–æ–≤ –ê–∑–∏–º"],
        files: [],
        comments: [],
        deadline: "2025-04-28"
    },
    {
        id: 28,
        dateSet: "2025-04-18",
        project: "–ó–∞–∫–∞–∑—á–∏–∫ Delta-2",
        theme: "–î–∏–∑–∞–π–Ω",
        description: "–°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–º–æ-—Å—Ç—Ä–∞–Ω–∏—Ü—É",
        status: "–í—ã–ø–æ–ª–Ω–µ–Ω–æ",
        executors: ["–ù—É—Ä–º–∞–Ω–æ–≤ –ê–Ω–≤–∞—Ä"],
        files: [],
        comments: [],
        deadline: "2025-04-25"
    },
    {
        id: 29,
        dateSet: "2025-04-19",
        project: "–ü—Ä–æ–µ–∫—Ç Epsilon-2",
        theme: "–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è",
        description: "–£–ª—É—á—à–∏—Ç—å SEO",
        status: "–í–æ–∑–≤—Ä–∞—â–µ–Ω",
        executors: ["–ù–∞—Ä–∑—É–ª–ª–æ–µ–≤ –¢–æ—Ö–∏—Ä"],
        files: [],
        comments: [],
        deadline: "2025-05-05"
    },
    {
        id: 30,
        dateSet: "2025-04-20",
        project: "–ó–∞–∫–∞–∑—á–∏–∫ Zeta-2",
        theme: "–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ",
        description: "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å",
        status: "–ü—Ä–∏–Ω—è—Ç–æ –∑–∞–∫–∞–∑—á–∏–∫–æ–º",
        executors: ["–†—É—Å—Ç–∞–º–æ–≤ –ñ–æ–Ω–∏–±–µ–∫"],
        files: [],
        comments: [],
        deadline: "2025-04-30"
    }
];
export let filters = {};
export let sortState = { field: null, ascending: true };
export let allProjects = [...new Set(tasks.map(task => task.project))];
export const paginationState = {
    currentPage: 1,
    tasksPerPage: 20
};
export function getAllExecutors() {
    // –°–æ–±–∏—Ä–∞–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π –∏–∑ –≤—Å–µ—Ö –∑–∞–¥–∞—á
    const executors = new Set();
    tasks.forEach(task => {
        task.executors.forEach(executor => {
            executors.add(executor);
        });
    });
    return Array.from(executors).sort();
}
import { createTable, createInterface } from './interface.js'

export function applyFilters() {
    const executorFilter = document.getElementById("executorFilter").value.toLowerCase();
    const projectFilter = document.getElementById("projectFilter").value.toLowerCase();
    const dateFrom = document.getElementById("dateFrom").value;
    const dateTo = document.getElementById("dateTo").value;

    let filteredTasks = tasks.filter(task => {
        const matchesExecutors = !executorFilter || task.executors.some(ex => ex.toLowerCase().includes(executorFilter));
        const matchesProject = !projectFilter || (task.project && task.project.toLowerCase().includes(projectFilter));
        const matchesDateFrom = !dateFrom || task.dateSet >= dateFrom;
        const matchesDateTo = !dateTo || task.dateSet <= dateTo;

        return matchesExecutors && matchesProject && matchesDateFrom && matchesDateTo;
    });

    sortTasks(filteredTasks);
    paginationState.currentPage = 1;
    createTable(filteredTasks);
}

export function sortTasks(taskList) {
    if (!sortState.field) return;

    taskList.sort((a, b) => {
        let valA = a[sortState.field];
        let valB = b[sortState.field];

        if (sortState.field === "dateSet" || sortState.field === "deadline") {
            valA = valA || "9999-12-31";
            valB = valB || "9999-12-31";
            return sortState.ascending ? valA.localeCompare(valB) : valB.localeCompare(valA);
        } else if (sortState.field === "id") {
            return sortState.ascending ? valA - valB : valB - valA;
        } else if (sortState.field === "executors") {
            valA = valA.length ? valA.join(", ") : "";
            valB = valB.length ? valB.join(", ") : "";
            return sortState.ascending ? valA.localeCompare(valB) : valB.localeCompare(valA);
        } else if (sortState.field === "status") {
            valA = valA || "–ù–µ —É–∫–∞–∑–∞–Ω";
            valB = valB || "–ù–µ —É–∫–∞–∑–∞–Ω";
            return sortState.ascending ? valA.localeCompare(valB) : valB.localeCompare(valA);
        } else {
            return sortState.ascending ? valA.localeCompare(valB) : valB.localeCompare(valA);
        }
    });
}

export function renderPagination(taskList, totalPages) {
    const paginationDiv = document.createElement("div");
    paginationDiv.className = "pagination";

    const prevBtn = document.createElement("button");
    prevBtn.textContent = "–ù–∞–∑–∞–¥";
    prevBtn.disabled = currentPage === 1;
    prevBtn.addEventListener("click", () => {
        if (currentPage > 1) {
            currentPage--;
            createTable(taskList);
        }
    });
    paginationDiv.appendChild(prevBtn);

    for (let i = 1; i <= totalPages; i++) {
        const pageBtn = document.createElement("button");
        pageBtn.textContent = i;
        pageBtn.classList.toggle("active", i === currentPage);
        pageBtn.addEventListener("click", () => {
            currentPage = i;
            createTable(taskList);
        });
        paginationDiv.appendChild(pageBtn);
    }

    const nextBtn = document.createElement("button");
    nextBtn.textContent = "–í–ø–µ—Ä–µ–¥";
    nextBtn.disabled = currentPage === totalPages;
    nextBtn.addEventListener("click", () => {
        if (currentPage < totalPages) {
            currentPage++;
            createTable(taskList);
        }
    });
    paginationDiv.appendChild(nextBtn);

    const appDiv = document.getElementById("app");
    appDiv.appendChild(paginationDiv);
}

export function openEditModal(task) {
    const modal = document.createElement("div");
    modal.className = "modal trello-style-modal";

    task.comments = task.comments || [];
    task.files = task.files || [];
    task.executors = task.executors || [];
    task.history = task.history || [];
    task.deadline = task.deadline || "";

    const statuses = ["–ü—Ä–∏–Ω—è—Ç–æ", "–í—ã–ø–æ–ª–Ω–µ–Ω–æ", "–ü—Ä–∏–Ω—è—Ç–æ –∑–∞–∫–∞–∑—á–∏–∫–æ–º", "–ê–Ω–Ω—É–ª–∏—Ä–æ–≤–∞–Ω–æ", "–í–æ–∑–≤—Ä–∞—â–µ–Ω"];

    // –ü–æ–ª—É—á–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
    const lastComment = task.comments.length ? task.comments[task.comments.length - 1] : null;
    const lastCommentText = lastComment ? lastComment.text : "";

    modal.innerHTML = `
        <div class="modal-content trello-modal-content">
            <div class="modal-header">
                <h2>${task.project || "–ë–µ–∑ –ø—Ä–æ–µ–∫—Ç–∞"}</h2>
                <span class="date-set">–î–∞—Ç–∞ –ø–æ—Å—Ç–∞–Ω–æ–≤–∫–∏: ${task.dateSet || "–ù–µ —É–∫–∞–∑–∞–Ω–∞"}</span>
                <div class="header-actions">
                    <span class="status-label">–°—Ç–∞—Ç—É—Å:</span>
                    <select id="statusSelect">
                        ${statuses.map(status => `
                            <option value="${status}" ${task.status === status ? 'selected' : ''}>${status}</option>
                        `).join('')}
                    </select>
                    <button class="close-modal-btn" id="closeModalBtn">√ó</button>
                </div>
            </div>
            <div class="modal-tabs">
                <button class="tab-btn active" data-tab="info">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–¥–∞—á–µ</button>
                <button class="tab-btn" data-tab="extras">–î–æ–ø–æ–ª–Ω–µ–Ω–∏—è –∫ –∑–∞–¥–∞—á–µ</button>
                <button class="tab-btn" data-tab="history">–ò—Å—Ç–æ—Ä–∏—è</button>
            </div>
            <div class="modal-body">
                <div class="tab-content" id="infoTab">
                    <div class="section">
                        <h3>–¢–µ–º–∞</h3>
                        <div class="editable-field">
                            <span id="themeDisplay">${task.theme || "–ù–µ—Ç —Ç–µ–º—ã"}</span>
                            <input type="text" id="editTheme" value="${task.theme || ""}" class="hidden">
                        </div>
                    </div>
                    <div class="section">
                        <h3>–û–ø–∏—Å–∞–Ω–∏–µ</h3>
                        <div class="editable-field">
                            <span id="descriptionDisplay">${task.description || "–ù–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—è"}</span>
                            <textarea id="editDescription" class="hidden">${task.description || ""}</textarea>
                        </div>
                    </div>
                    <div class="section comment-section">
                        <h3>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</h3>
                        <div class="comment-wrapper">
                            <textarea id="newComment" placeholder=""></textarea>
                            <span id="lastCommentOverlay" class="last-comment-overlay">${lastCommentText || "–ù–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è"}</span>
                        </div>
                        <button id="addComment">–î–æ–±–∞–≤–∏—Ç—å</button>
                    </div>
                    <div class="section">
                        <h3>–í–ª–æ–∂–µ–Ω–∏—è</h3>
                        <div id="fileList">
                            ${task.files.length ? task.files.map(file => `
                                <div class="file-item">
                                    <a href="${file.url}" target="_blank">${file.name}</a>
                                </div>
                            `).join("") : "–ù–µ—Ç —Ñ–∞–π–ª–æ–≤"}
                        </div>
                    </div>
                </div>
                <div class="tab-content hidden" id="extrasTab">
                    <div class="section">
                        <h3>–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–∏</h3>
                        <div id="executorList" class="executor-list"></div>
                    </div>
                    <div class="section">
                        <h3>–î–µ–¥–ª–∞–π–Ω</h3>
                        <div class="editable-field">
                            <span id="deadlineDisplay">${task.deadline || "–ù–µ —É–∫–∞–∑–∞–Ω"}</span>
                            <input type="date" id="editDeadline" value="${task.deadline || ""}" class="hidden">
                        </div>
                    </div>
                </div>
                <div class="tab-content hidden" id="historyTab">
                    <div class="section">
                        <h3>–ò—Å—Ç–æ—Ä–∏—è</h3>
                        <div id="historyList">
                            ${task.history.length ? task.history.map((entry) => `
                                <div class="history-item">
                                    <span class="history-date">${entry.date}</span>
                                    <span class="history-change">${entry.change}</span>
                                    <span class="history-user">${entry.user}</span>
                                </div>
                            `).join("") : "–ù–µ—Ç –∏—Å—Ç–æ—Ä–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π"}
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="saveBtn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <button id="closeBtn">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
    `;

    document.body.appendChild(modal);

    const originalTask = JSON.parse(JSON.stringify(task));

    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫
    modal.querySelectorAll(".tab-btn").forEach(btn => {
        btn.addEventListener("click", (e) => {
            e.stopPropagation();
            modal.querySelectorAll(".tab-btn").forEach(b => b.classList.remove("active"));
            btn.classList.add("active");
            modal.querySelectorAll(".tab-content").forEach(content => content.classList.add("hidden"));
            modal.querySelector(`#${btn.dataset.tab}Tab`).classList.remove("hidden");
        });
    });

    // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–º—ã, –æ–ø–∏—Å–∞–Ω–∏—è –∏ –¥–µ–¥–ª–∞–π–Ω–∞
    ["theme", "description", "deadline"].forEach(field => {
        const display = modal.querySelector(`#${field}Display`);
        const input = modal.querySelector(`#edit${field.charAt(0).toUpperCase() + field.slice(1)}`);

        if (display && input) {
            display.addEventListener("dblclick", (e) => {
                e.stopPropagation();
                display.classList.add("hidden");
                input.classList.remove("hidden");
                input.focus();
            });

            if (field === "deadline") {
                input.addEventListener("change", () => {
                    task[field] = input.value;
                    display.textContent = task[field] || "–ù–µ —É–∫–∞–∑–∞–Ω";
                    display.classList.remove("hidden");
                    input.classList.add("hidden");
                });
            } else {
                input.addEventListener("keypress", (e) => {
                    if (e.key === "Enter") {
                        e.preventDefault();
                        task[field] = input.value;
                        display.textContent = task[field] || (field === "theme" ? "–ù–µ—Ç —Ç–µ–º—ã" : "–ù–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—è");
                        display.classList.remove("hidden");
                        input.classList.add("hidden");
                    }
                });
            }

            input.addEventListener("blur", () => {
                if (field !== "deadline") {
                    input.value = task[field] || "";
                }
                display.classList.remove("hidden");
                input.classList.add("hidden");
            });
        }
    });

    // –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–∏
    const executorList = modal.querySelector("#executorList");
    function updateExecutorList() {
        executorList.innerHTML = '';
        task.executors.forEach(ex => {
            const executorItem = document.createElement("span");
            executorItem.className = "executor-item";
            executorItem.innerHTML = `
                <span class="executor-name">${ex}</span>
                <button class="remove-executor" data-executor="${ex}">√ó</button>
            `;
            executorList.appendChild(executorItem);
        });

        if (!task.executors.length) {
            const noExecutors = document.createElement("span");
            noExecutors.textContent = "–ù–µ –Ω–∞–∑–Ω–∞—á–µ–Ω—ã";
            executorList.appendChild(noExecutors);
        }

        const addButton = document.createElement("button");
        addButton.className = "add-executor-btn";
        addButton.innerHTML = `<img src="./image/plus.svg" style="width: 16px; height: 16px;">`;
        executorList.appendChild(addButton);

        addButton.addEventListener("click", (e) => {
            e.stopPropagation();
            if (!executorList.querySelector("#addExecutorSelect")) {
                const selectWrapper = document.createElement("span");
                selectWrapper.className = "executor-item";
                selectWrapper.innerHTML = `
                    <select id="addExecutorSelect">
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è</option>
                        ${getAllExecutors().filter(ex => !task.executors.includes(ex)).map(ex => `
                            <option value="${ex}">${ex}</option>
                        `).join("")}
                    </select>
                    <button class="cancel-add-executor">√ó</button>
                `;
                executorList.replaceChild(selectWrapper, addButton);

                const addExecutorSelect = selectWrapper.querySelector("#addExecutorSelect");
                addExecutorSelect.addEventListener("change", (e) => {
                    e.stopPropagation();
                    const newExecutor = addExecutorSelect.value;
                    if (newExecutor && !task.executors.includes(newExecutor)) {
                        task.executors.push(newExecutor);
                        updateExecutorList();
                    }
                });

                selectWrapper.querySelector(".cancel-add-executor").addEventListener("click", (e) => {
                    e.stopPropagation();
                    executorList.replaceChild(addButton, selectWrapper);
                });
            }
        });

        executorList.querySelectorAll(".remove-executor").forEach(btn => {
            btn.addEventListener("click", (e) => {
                e.stopPropagation();
                const executor = btn.dataset.executor;
                task.executors = task.executors.filter(ex => ex !== executor);
                updateExecutorList();
            });
        });

        executorList.querySelectorAll(".executor-name").forEach(span => {
            span.addEventListener("dblclick", (e) => {
                e.stopPropagation();
                const oldExecutor = span.textContent;
                const executorItem = span.parentElement;

                const select = document.createElement("select");
                select.innerHTML = `
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è</option>
                    ${getAllExecutors().filter(ex => !task.executors.includes(ex) || ex === oldExecutor).map(ex => `
                        <option value="${ex}" ${ex === oldExecutor ? 'selected' : ''}>${ex}</option>
                    `).join("")}
                `;
                executorItem.replaceChild(select, span);
                select.focus();

                select.addEventListener("change", (e) => {
                    e.stopPropagation();
                    const newExecutor = select.value;
                    if (newExecutor && newExecutor !== oldExecutor && !task.executors.includes(newExecutor)) {
                        const index = task.executors.indexOf(oldExecutor);
                        task.executors[index] = newExecutor;
                    }
                    updateExecutorList();
                });

                select.addEventListener("blur", () => {
                    updateExecutorList();
                });
            });
        });
    }
    updateExecutorList();

    // –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
    const addCommentBtn = modal.querySelector("#addComment");
    const newCommentTextarea = modal.querySelector("#newComment");
    const lastCommentOverlay = modal.querySelector("#lastCommentOverlay");

    // –ü—Ä—è—á–µ–º overlay, –µ—Å–ª–∏ –µ—Å—Ç—å —Ç–µ–∫—Å—Ç –≤ textarea
    newCommentTextarea.addEventListener("input", () => {
        lastCommentOverlay.style.display = newCommentTextarea.value.trim() ? "none" : "block";
    });

    if (addCommentBtn) {
        addCommentBtn.addEventListener("click", (e) => {
            e.stopPropagation();
            const commentText = newCommentTextarea.value.trim();
            if (commentText) {
                const newComment = {
                    text: commentText,
                    date: new Date().toLocaleDateString()
                };
                // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –≤ –º–∞—Å—Å–∏–≤ –∏ —Å—Ä–∞–∑—É –≤ –∏—Å—Ç–æ—Ä–∏—é
                task.comments.push(newComment);
                task.history.push({
                    date: newComment.date,
                    change: `–î–æ–±–∞–≤–ª–µ–Ω –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: "${newComment.text}"`,
                    user: "–¢–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å"
                });
                // –û–±–Ω–æ–≤–ª—è–µ–º overlay —Å –Ω–æ–≤—ã–º –ø–æ—Å–ª–µ–¥–Ω–∏–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–º
                lastCommentOverlay.textContent = newComment.text;
                lastCommentOverlay.style.display = "block";
                newCommentTextarea.value = ""; // –û—á–∏—â–∞–µ–º textarea
                // –û–±–Ω–æ–≤–ª—è–µ–º –∏—Å—Ç–æ—Ä–∏—é
                modal.querySelector("#historyList").innerHTML = task.history.length ?
                    task.history.map((entry) => `
                        <div class="history-item">
                            <span class="history-date">${entry.date}</span>
                            <span class="history-change">${entry.change}</span>
                            <span class="history-user">${entry.user}</span>
                        </div>
                    `).join("") : "–ù–µ—Ç –∏—Å—Ç–æ—Ä–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π";
            }
        });
    }

    // –ó–∞–∫—Ä—ã—Ç–∏–µ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
    const closeModal = () => {
        Object.assign(task, originalTask);
        modal.remove();
    };

    modal.querySelector("#closeModalBtn").addEventListener("click", closeModal);
    modal.querySelector("#closeBtn").addEventListener("click", closeModal);

    modal.querySelector("#saveBtn").addEventListener("click", (e) => {
        e.stopPropagation();
        const newStatus = modal.querySelector("#statusSelect").value;
        if (task.status !== newStatus) {
            task.history.push({
                date: new Date().toLocaleDateString(),
                change: `–°—Ç–∞—Ç—É—Å –∏–∑–º–µ–Ω–µ–Ω —Å "${task.status}" –Ω–∞ "${newStatus}"`,
                user: "–¢–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å"
            });
            task.status = newStatus;
        }
        applyFilters();
        modal.remove();
    });

    modal.addEventListener("click", (e) => {
        if (!modal.querySelector(".modal-content").contains(e.target)) closeModal();
    });
}

export function bindEventListeners(section, task, modal) {
    const content = modal.querySelector(`.accordion-header[data-section="${section}"]`).nextElementSibling;

    if (section === "theme" || section === "description") {
        const editBtn = content.querySelector(`.edit-btn[data-field="${section}"]`);
        if (editBtn) {
            editBtn.addEventListener("click", () => {
                const display = content.querySelector(`#${section}Display`);
                const input = content.querySelector(`#edit${section.charAt(0).toUpperCase() + section.slice(1)}`);
                display.classList.toggle("hidden");
                input.classList.toggle("hidden");
                editBtn.textContent = display.classList.contains("hidden") ? "üíæ" : "‚úèÔ∏è";
                if (!display.classList.contains("hidden")) {
                    task[section] = input.value;
                    display.textContent = task[section] || `–ù–µ—Ç ${section === "theme" ? "—Ç–µ–º—ã" : "–æ–ø–∏—Å–∞–Ω–∏—è"}`;
                }
            });
        }
    }

    if (section === "executors") {
        const executorList = content.querySelector("#executorList");
        executorList.querySelectorAll(".remove-executor").forEach(btn => {
            btn.addEventListener("click", () => {
                const executor = btn.dataset.executor;
                task.executors = task.executors.filter(ex => ex !== executor);
                addSection("executors", task, modal);
            });
        });

        const addExecutorSelect = content.querySelector("#addExecutorSelect");
        if (addExecutorSelect) {
            addExecutorSelect.addEventListener("change", () => {
                const newExecutor = addExecutorSelect.value;
                if (newExecutor && !task.executors.includes(newExecutor)) {
                    task.executors.push(newExecutor);
                    addSection("executors", task, modal);
                }
                addExecutorSelect.value = "";
            });
        }
    }

    if (section === "comments") {
        const addCommentBtn = content.querySelector("#addComment");
        if (addCommentBtn) {
            addCommentBtn.addEventListener("click", () => {
                const commentText = content.querySelector("#newComment").value.trim();
                if (commentText) {
                    task.comments.push({
                        text: commentText,
                        date: new Date().toLocaleDateString()
                    });
                    addSection("comments", task, modal);
                }
            });
        }

        content.querySelectorAll(".remove-comment").forEach(btn => {
            btn.addEventListener("click", () => {
                const index = parseInt(btn.dataset.index);
                task.comments.splice(index, 1);
                addSection("comments", task, modal);
            });
        });
    }
}

document.addEventListener("DOMContentLoaded", createInterface);